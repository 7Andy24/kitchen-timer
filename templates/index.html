<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Timer</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Kitchen Timer</h1>

    <input type="number" id="minutes" placeholder="Minutes">
    <input type="number" id="seconds" placeholder="Seconds">
    <br><br>
    <button onclick="startTimer()">Start</button>
    <button onclick="repeatTimer()">Repeat</button>
    <button onclick="pauseResumeTimer()">‚èØ Pause / Resume</button>

    <button onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>

    <svg id="visual-timer" width="200" height="200" viewBox="0 0 100 100">
    <!-- Outer white rim -->
    <circle cx="50" cy="50" r="48" fill="white" />

    <g id="tick-marks">
  <!-- Tick marks will go here via JavaScript -->
    </g>

    <!-- Background circle (gray track) -->
    <circle cx="50" cy="50" r="45" stroke="#444" stroke-width="6" fill="none" />

    <!-- Dynamic blue pie wedge -->
    <path id="progress-arc" fill="#2196f3" transform="rotate(-90 50 50)"></path>

    <!-- Inner black center -->
    <circle cx="50" cy="50" r="25" fill="black" />
    </svg>

    <h2 id="display">00:00</h2>

    <audio id="alarmSound" src="{{ url_for('static', filename='Ringtone-1-timer.mp3') }}"></audio>

    <script>
    let lastMinutes = 0;
    let lastSeconds = 0;
    let interval;
    let total = 0;
    let isPaused = false;

    function updateVisualArc(percentRemaining) {
    const arc = document.getElementById("progress-arc");
    const radius = 45;
    const circumference = 2 * Math.PI * radius;
    const angle = 360 * percentRemaining;

    const largeArc = angle > 180 ? 1 : 0;
    const endX = 50 + radius * Math.cos((angle - 90) * Math.PI / 180);
    const endY = 50 + radius * Math.sin((angle - 90) * Math.PI / 180);

    const pathData = `
        M 50,50
        L 50,5
        A ${radius},${radius} 0 ${largeArc} 1 ${endX},${endY}
        Z
    `;

        if (percentRemaining <= 0) {
        arc.setAttribute("d", "");
        } else {
        arc.setAttribute("d", pathData);
        }
    }

    function createTickMarks(count = 60) {
        const group = document.getElementById("tick-marks");
        const radiusOuter = 48;
        const radiusInner = 44;
        const radiusMajor = 42;
        const radiusText = 36;

        group.innerHTML = ''; // Clear any existing ticks/numbers

        for (let i = 0; i < count; i++) {
            const angle = (2 * Math.PI / count) * i - Math.PI / 2;

            // Thicker ticks every 5
            const isMajor = i % 5 === 0;
            const outer = radiusOuter;
            const inner = isMajor ? radiusMajor : radiusInner;

            const x1 = 50 + outer * Math.cos(angle);
            const y1 = 50 + outer * Math.sin(angle);
            const x2 = 50 + inner * Math.cos(angle);
            const y2 = 50 + inner * Math.sin(angle);

            const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
            tick.setAttribute("x1", x1);
            tick.setAttribute("y1", y1);
            tick.setAttribute("x2", x2);
            tick.setAttribute("y2", y2);
            tick.setAttribute("stroke", "#ffffff");
            tick.setAttribute("stroke-width", isMajor ? "1.5" : "0.7");

            group.appendChild(tick);

            // Add clock-style numbers every 15 seconds (i.e., 0, 15, 30, 45)
            if (i % 15 === 0) {
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                const x = 50 + radiusText * Math.cos(angle);
                const y = 50 + radiusText * Math.sin(angle) + 3; // +3 to align baseline

                label.setAttribute("x", x);
                label.setAttribute("y", y);
                label.setAttribute("text-anchor", "middle");
                label.setAttribute("fill", "#ffffff");
                label.setAttribute("font-size", "5");
                label.setAttribute("font-family", "sans-serif");

                const labelVal = (i === 0) ? "0" : String(i);
                label.textContent = labelVal;

                group.appendChild(label);
            }
        }
    }


    function startTimer() {
        const minutesInput = parseInt(document.getElementById("minutes").value) || 0;
        const secondsInput = parseInt(document.getElementById("seconds").value) || 0;

        lastMinutes = minutesInput;
        lastSeconds = secondsInput;

        total = minutesInput * 60 + secondsInput;
        isPaused = false;

        runTimer();
    }

    function repeatTimer() {
        total = lastMinutes * 60 + lastSeconds;
        isPaused = false;
        runTimer();
    }

    function pauseResumeTimer() {
        isPaused = !isPaused;

        if (!isPaused) {
            runTimer(); // resume
        } else {
            clearInterval(interval); // pause
        }
    }

    function runTimer() {
        clearInterval(interval);

        interval = setInterval(() => {
            if (!isPaused) {
                let min = Math.floor(total / 60);
                let sec = total % 60;

                document.getElementById("display").textContent =
                    String(min).padStart(2, '0') + ":" + String(sec).padStart(2, '0');

                total--;

                updateVisualArc(total / (lastMinutes * 60 + lastSeconds));

                if (total < 0) {
                    clearInterval(interval);
                    const sound = document.getElementById("alarmSound");
                    sound.currentTime = 0;
                    sound.play().catch((e) => {
                        console.log("Sound play error:", e);
                    });
                    setTimeout(() => {
                        alert("Time's up!");
                    }, 500);
                }
            }
        }, 1000);
    }

    createTickMarks(); // ‚úÖ Call it once on page load
</script>    
</body>
</html>
