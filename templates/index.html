<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Timer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <h1>Kitchen Timer</h1>

    <input type="number" id="minutes" placeholder="Minutes">
    <input type="number" id="seconds" placeholder="Seconds">
    <br><br>
    <button onclick="startTimer()">Start</button>
    <button onclick="repeatTimer()">Repeat</button>

    <button onclick="toggleDarkMode()">ðŸŒ™ Toggle Dark Mode</button>

    <h2 id="display">00:00</h2>

    <audio id="alarmSound" src="{{ url_for('static', filename='Ringtone-1-timer.mp3') }}"></audio>

    <script>
        let lastMinutes = 0;
        let lastSeconds = 0;
        let interval;
    
        function toggleDarkMode() {
            const isDark = document.body.classList.toggle("dark");
            localStorage.setItem("darkMode", isDark ? "enabled" : "disabled");
        }               

        function startTimer() {
            const minutesInput = parseInt(document.getElementById("minutes").value) || 0;
            const secondsInput = parseInt(document.getElementById("seconds").value) || 0;
    
            lastMinutes = minutesInput;
            lastSeconds = secondsInput;
    
            runTimer(minutesInput, secondsInput);
        }
    
        function repeatTimer() {
            runTimer(lastMinutes, lastSeconds);
        }
    
        function runTimer(minutes, seconds) {
            clearInterval(interval);  // Clear any existing timer
            let total = minutes * 60 + seconds;
    
            interval = setInterval(() => {
                let min = Math.floor(total / 60);
                let sec = total % 60;
    
                document.getElementById("display").textContent =
                    String(min).padStart(2, '0') + ":" + String(sec).padStart(2, '0');
    
                total--;
    
                if (total < 0) {
                    clearInterval(interval);
                    const sound = document.getElementById("alarmSound");
                    sound.currentTime = 0;
                    sound.play().catch((e) => {
                        console.log("Sound play error:", e);
                    });
                    setTimeout(() => {
                        alert("Time's up!");
                    }, 500);
                }
            }, 1000);
        }
        // Apply saved dark mode on page load
        window.onload = function() {
        const savedMode = localStorage.getItem("darkMode");
        if (savedMode === "enabled") {
        document.body.classList.add("dark");
        }
    };

    </script>    
</body>
</html>
