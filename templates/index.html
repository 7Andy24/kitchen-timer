<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Timer</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Kitchen Timer</h1>

    <input type="number" id="minutes" placeholder="Minutes">
    <input type="number" id="seconds" placeholder="Seconds">
    <br><br>
    <button onclick="startTimer()">Start</button>
    <button onclick="repeatTimer()">Repeat</button>
    <button onclick="pauseResumeTimer()">‚èØ Pause / Resume</button>

    <button onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>

    <svg id="visual-timer" width="200" height="200" viewBox="0 0 100 100">
    <circle cx="50" cy="50" r="45" stroke="#ddd" stroke-width="10" fill="none" />
    <path id="progress-arc" fill="#00bcd4" transform="rotate(-90 50 50)"></path>
    </svg>

    <h2 id="display">00:00</h2>

    <audio id="alarmSound" src="{{ url_for('static', filename='Ringtone-1-timer.mp3') }}"></audio>

    <script>
    let lastMinutes = 0;
    let lastSeconds = 0;
    let interval;
    let total = 0;
    let isPaused = false;

    function updateVisualArc(percentRemaining) {
    const arc = document.getElementById("progress-arc");
    const radius = 45;
    const circumference = 2 * Math.PI * radius;
    const angle = 360 * percentRemaining;

    const largeArc = angle > 180 ? 1 : 0;
    const endX = 50 + radius * Math.cos((angle - 90) * Math.PI / 180);
    const endY = 50 + radius * Math.sin((angle - 90) * Math.PI / 180);

    const pathData = `
        M 50,50
        L 50,5
        A ${radius},${radius} 0 ${largeArc} 1 ${endX},${endY}
        Z
    `;

        if (percentRemaining <= 0) {
        arc.setAttribute("d", "");
        } else {
        arc.setAttribute("d", pathData);
        }
    }

    function startTimer() {
        const minutesInput = parseInt(document.getElementById("minutes").value) || 0;
        const secondsInput = parseInt(document.getElementById("seconds").value) || 0;

        lastMinutes = minutesInput;
        lastSeconds = secondsInput;

        total = minutesInput * 60 + secondsInput;
        isPaused = false;

        runTimer();
    }

    function repeatTimer() {
        total = lastMinutes * 60 + lastSeconds;
        isPaused = false;
        runTimer();
    }

    function pauseResumeTimer() {
        isPaused = !isPaused;

        if (!isPaused) {
            runTimer(); // resume
        } else {
            clearInterval(interval); // pause
        }
    }

    function runTimer() {
        clearInterval(interval);

        interval = setInterval(() => {
            if (!isPaused) {
                let min = Math.floor(total / 60);
                let sec = total % 60;

                document.getElementById("display").textContent =
                    String(min).padStart(2, '0') + ":" + String(sec).padStart(2, '0');

                total--;

                updateVisualArc(total / (lastMinutes * 60 + lastSeconds));

                if (total < 0) {
                    clearInterval(interval);
                    const sound = document.getElementById("alarmSound");
                    sound.currentTime = 0;
                    sound.play().catch((e) => {
                        console.log("Sound play error:", e);
                    });
                    setTimeout(() => {
                        alert("Time's up!");
                    }, 500);
                }
            }
        }, 1000);
    }
</script>    
</body>
</html>
